<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>bus</title>

  <!--
    TODO(security): re-enable CSP before production.
    The strict CSP is temporarily disabled during deployment/testing across variable relay URLs.
  -->
  <!--
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'none';
          script-src 'self';
          style-src 'self';
          img-src 'self' data:;
          connect-src 'self' https://api.example.com http://localhost:* http://127.0.0.1:*;
          manifest-src 'self';
          worker-src 'self';
          base-uri 'none';
          frame-ancestors 'none';
          form-action 'none';
        ">
  -->

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="app">
    <header class="topbar">
      <div>
        <div class="title">Local <-> Global Bus</div>
        <div id="connState" class="conn">Not connected</div>
      </div>
      <div class="actions">
        <button id="btnOpenScanner" class="icon-btn" type="button" title="Scan QR">QR</button>
        <button id="btnInstall" class="icon-btn" type="button" title="Install app" hidden>Install</button>
        <button id="btnEnablePush" class="icon-btn" type="button" title="Enable push" hidden>Push</button>
        <button id="btnToggleMeta" class="icon-btn" type="button" title="Menu">Menu</button>
      </div>
    </header>

    <section id="messages" class="messages"></section>

    <form id="composer" class="composer">
      <input id="msgInput" autocomplete="off" placeholder="Type a message..." />
      <button id="btnSend" type="submit">Send</button>
    </form>

    <section id="metaPanel" class="meta-panel" hidden>
      <div class="meta-line"><span>Node</span><code id="nodeDeviceId"></code></div>
      <div class="meta-line"><span>Inbox</span><code id="inboxDeviceId"></code></div>
      <div class="meta-line"><span>Relay</span><code id="relayUrl"></code></div>
      <div id="pairStatus" class="status"></div>
      <div id="installStatus" class="status"></div>
      <div id="pushStatus" class="status"></div>
      <details>
        <summary>Debug curl</summary>
        <pre id="curlHint" class="debug-block"></pre>
      </details>
      <details>
        <summary>Pairing payload</summary>
        <pre id="pairingPayloadView" class="debug-block"></pre>
      </details>
    </section>

    <section id="scanOverlay" class="scan-overlay" hidden>
      <div class="scan-panel">
        <div id="qrScanner" class="qr-scanner"></div>
        <div id="scanStatus" class="status"></div>
        <button id="btnStopScan" type="button" class="ghost-btn">Close Scanner</button>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
